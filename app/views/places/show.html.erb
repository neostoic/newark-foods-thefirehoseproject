<div class="container">
  <div class="row">
    <div class="col-sm-8">
      <h1><%= @place.name %> <small><%= @place.address %></small></h1>
      <p class="lead"><%= @place.description %></p>
      <hr>

      <% if @place.latitude.present? && @place.longitude.present? %>
        <script>
          function initMap() {
            var myLatLng = {
              lat: <%= @place.latitude %>,
              lng: <%= @place.longitude %>
            };

            var map = new google.maps.Map(document.getElementById('map'), {
              zoom: 15,
              center: myLatLng
            });

            var marker = new google.maps.Marker({
              position: myLatLng,
              map: map,
              title: 'Hello World!'
            });
          }
        </script>

        <script async defer src="https://maps.googleapis.com/maps/api/js?key=&signed_in=true&callback=initMap"></script>

        <div id="map"></div>
      <% end %>

      <hr>

      <% unless @place.comments.empty? %>
        <% @place.comments.each do |comment| %>
          <div class="media">
            <div class="media-left media-middle">
              <img src="http://placehold.it/70/70" alt="Placeholder" class="media-object">
            </div>
            <div class="media-body">
              <h4 class="media-heading"><strong><%= comment.user.email %></strong> says <span class="label label-info"><%= comment.human_rating if comment.human_rating.present? %></span></h4>
              <p><%= comment.message %></p>
            </div>
          </div>
        <% end %>
      <% end %>

      <hr>

      <h3>Add A Comment &amp; Rating</h3>
      <%= simple_form_for(@comment, url: place_comments_path(@place)) do |form| %>
        <%= form.input :message %>
        <%= form.input :rating, collection: Comment::RATINGS %>
        <%= form.submit("Add a comment", :class => 'btn btn-success') %>
      <% end %>

    </div>
    <div class="col-sm-4">
      <h3>Available Actions</h3>

      <% if current_user && current_user == @place.user %>
        <%= link_to("Edit Place", edit_place_path(@place), :class => 'btn btn-primary') %>
        <%= link_to("Delete Place", place_path(@place), {:class => 'btn btn-danger', :method => :delete, :data => {:confirm => "Are you sure you want to delete this place?"}}) %>
      <% elsif !current_user %>
        <p>Please sign in to modify restaurant listings.</p>
      <% else %>
        <p>You don't have permission to modify this listing.</p>
      <% end %>

    </div>
  </div>
</div>
